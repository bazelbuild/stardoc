---
matrix:
  platform:
    - ubuntu1804
    - ubuntu2004
    - macos
    - windows

tasks:
  build_and_test:
    name: Build and test
    platform: ${{ platform }}
    build_targets:
      - "//..."
    test_targets:
      - "//..."

  build_and_test_last_green:
    name: Build and test - last green/green
    platform: ${{ platform }}
    bazel: last_green
    build_targets:
      - "//..."
    test_targets:
      - "//..."

  bzlmod:
    name: Bzlmod example
    platform: ${{ platform }}
    working_directory: test/bzlmod
    build_targets:
      - "//..."
    test_targets:
      - "//..."

buildifier: latest
