---
matrix:
  platform:
    - ubuntu1804
    - ubuntu2004
    - macos
    - windows

tasks:
  build_and_test:
    name: Build and test
    platform: ${{ platform }}
    build_flags:
      - "--incompatible_disable_starlark_host_transitions"
    build_targets:
      - "//..."
    test_flags:
      - "--incompatible_disable_starlark_host_transitions"
    test_targets:
      - "//..."

  build_and_test_last_green:
    name: Build and test - Bazel last green
    platform: ${{ platform }}
    bazel: last_green
    build_flags:
      - "--incompatible_disable_starlark_host_transitions"
    build_targets:
      - "//..."
    test_flags:
      - "--incompatible_disable_starlark_host_transitions"
    test_targets:
      - "//..."

  bzlmod:
    name: Bzlmod example
    platform: ${{ platform }}
    working_directory: test/bzlmod
    build_flags:
      - "--incompatible_disable_starlark_host_transitions"
      - "--enable_bzlmod"
    build_targets:
      - "//..."
    test_flags:
      - "--incompatible_disable_starlark_host_transitions"
      - "--enable_bzlmod"
    test_targets:
      - "//..."

buildifier: latest
